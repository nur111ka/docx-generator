{% extends "base.html" %}

{% block title %}Настройка шаблона - DOCX Generator{% endblock %}
{% block header %}Настройка шаблона: {{ template_name }}{% endblock %}

{% block content %}
<div class="nav">
    <a href="/admin">Назад в админку</a>
    <a href="/admin/templates/manage">К списку шаблонов</a>
</div>

<h2>Добавление поля</h2>
<form method="POST">
    <input type="hidden" name="action" value="add_field">
    
    <div class="form-group">
        <label for="field_name">Имя поля (техническое):</label>
        <input type="text" id="field_name" name="field_name" placeholder="client_name" required>
    </div>
    
    <div class="form-group">
        <label for="field_label">Отображаемое имя:</label>
        <input type="text" id="field_label" name="field_label" placeholder="ФИО клиента" required>
    </div>
    
    <div class="form-group">
        <label for="field_type">Тип поля:</label>
        <select id="field_type" name="field_type">
            <option value="text">Текст</option>
            <option value="date">Дата</option>
            <option value="number">Число</option>
        </select>
    </div>
    
    <button type="submit">Добавить поле</button>
</form>

<h2>Поля шаблона</h2>
<table>
    <thead>
        <tr>
            <th>Имя поля</th>
            <th>Отображаемое имя</th>
            <th>Тип</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for field in fields %}
        <tr>
            <td><code>{{ field[0] }}</code></td>
            <td>{{ field[1] }}</td>
            <td>{{ field[2] }}</td>
            <td>
                <form method="POST" style="display: inline;">
                    <input type="hidden" name="action" value="delete_field">
                    <input type="hidden" name="field_name" value="{{ field[0] }}">
                    <button type="submit" style="padding: 5px 10px; font-size: 12px;">Удалить</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>Загрузка файла шаблона (.docx)</h2>
<form method="POST" enctype="multipart/form-data">
    <input type="hidden" name="action" value="upload_template_file">
    
    <div class="form-group">
        <label for="template_file">Выберите файл:</label>
        <input type="file" id="template_file" name="template_file" accept=".docx" required>
    </div>
    
    <button type="submit">Загрузить</button>
</form>

{% if template_file_exists %}
<div class="success">Файл шаблона загружен</div>
{% else %}
<div class="info-box">Файл шаблона не загружен</div>
{% endif %}

<h2>JSON замены</h2>
<p>Укажите固定ные замены, которые будут применяться ко всем документам:</p>
<form method="POST">
    <input type="hidden" name="action" value="save_replacements">
    
    <div class="form-group">
        <label for="replacements_json">JSON:</label>
        <textarea id="replacements_json" name="replacements_json" rows="10" style="font-family: monospace;">{{ replacements_json }}</textarea>
    </div>
    
    <button type="submit">Сохранить</button>
</form>

<h3>Пример формата JSON:</h3>
<pre style="background: #f5f5f5; padding: 15px; border-radius: 10px; overflow-x: auto;">
{
    "[COMPANY_NAME]": "ООО Ромашка",
    "[COMPANY_ADDRESS]": "г. Москва, ул. Примерная 1",
    "[INN]": "1234567890"
}
</pre>
{% endblock %}
